"use strict";var ApplicationConfiguration=function(){return{applicationModuleName:"mean",applicationModuleVendorDependencies:["ngResource","ngAnimate","ui.router","ngSanitize","ngMessages","ngFileUpload","ngCookies","LocalStorageModule"],registerModule:function(e,t){angular.module(e,t||[]),angular.module("mean").requires.push(e)}}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider",function(e,t){t.defaults.withCredentials=!0,e.hashPrefix("!")}]),angular.element(document).ready(function(){angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("home",{url:"/",templateUrl:"/modules/admin-core/views/home.html"})}]),angular.module("core").factory("Authentication",["$window",function(e){return{user:e.user}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var e=function(e){if(!e)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var t in e.roles)for(var n in this.roles)if(this.roles[n]===e.roles[t])return!0;return!1};this.validateMenuExistance=function(e){if(e&&e.length){if(this.menus[e])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(e){return this.validateMenuExistance(e),this.menus[e]},this.addMenu=function(t,n,a){return this.menus[t]={isPublic:n||!1,roles:a||this.defaultRoles,items:[],shouldRender:e},this.menus[t]},this.removeMenu=function(e){this.validateMenuExistance(e),delete this.menus[e]},this.addMenuItem=function(t,n,a,i,r,o,s,u){return this.validateMenuExistance(t),this.menus[t].items.push({title:n,link:a,menuItemType:i||"item",menuItemClass:i,uiRoute:r||"/"+a,isPublic:null===o||void 0===o?this.menus[t].isPublic:o,roles:null===s||void 0===s?this.menus[t].roles:s,position:u||0,items:[],shouldRender:e}),this.menus[t]},this.addSubMenuItem=function(t,n,a,i,r,o,s,u){this.validateMenuExistance(t);for(var c in this.menus[t].items)this.menus[t].items[c].link===n&&this.menus[t].items[c].items.push({title:a,link:i,uiRoute:r||"/"+i,isPublic:null===o||void 0===o?this.menus[t].items[c].isPublic:o,roles:null===s||void 0===s?this.menus[t].items[c].roles:s,position:u||0,shouldRender:e});return this.menus[t]},this.removeMenuItem=function(e,t){this.validateMenuExistance(e);for(var n in this.menus[e].items)this.menus[e].items[n].link===t&&this.menus[e].items.splice(n,1);return this.menus[e]},this.removeSubMenuItem=function(e,t){this.validateMenuExistance(e);for(var n in this.menus[e].items)for(var a in this.menus[e].items[n].items)this.menus[e].items[n].items[a].link===t&&this.menus[e].items[n].items.splice(a,1);return this.menus[e]},this.addMenu("topbar")}]),angular.module("core").factory("Notice",["$rootScope",function(e){var t=[],n="",a="";return e.$on("$stateChangeStart",function(){n=a,a=t.shift()||""}),e.$on("requireChange",function(){n=a,a=t.shift()||""}),e.$on("$stateChangeError",function(){t.push(n),a=""}),{setNotice:function(n,a,i){var i=void 0!==i&&i;t.push({type:a,message:n}),i&&e.$broadcast("requireChange")},getNotice:function(){return a},requireChange:function(){e.$broadcast("requireChange")},SUCCESS:"SUCCESS",ERROR:"ERROR",INFO:"INFO",clearNotice:function(){t=[],a="",e.$broadcast("CLEAR_NOTICE")}}}]),ApplicationConfiguration.registerModule("caches"),angular.module("caches").run(["Menus",function(e){e.addMenuItem("topbar","Cache","caches","dropdown","/caches(/create)?"),e.addSubMenuItem("topbar","caches","Danh sách","caches")}]).config(["$stateProvider",function(e){e.state("listCaches",{url:"/caches",templateUrl:"/modules/admin-cache/views/list-caches.client.view.html"})}]),angular.module("caches").controller("CachesController",["$scope","$window","$stateParams","$location","Option","Authentication","Caches","Notice","localStorageService","Upload",function(e,t,n,a,i,r,o,s,u,c){function l(){var t={page:e.currentPage,keyword:e.search.keyword};u.set("cache.filterData",{currentPage:e.currentPage,search:e.search}),o.query(t,function(t){console.log("Data",t),e.caches=t.items,e.totalItems=t.totalItems,e.itemsPerPage=t.itemsPerPage,e.numberVisiblePages=t.numberVisiblePages,e.totalPage=t.totalPage||1})}e.authentication=r,e.filePath="/files/cache/",e.webUrl=t.settings.services.webUrl,r.user.name||a.path("signin"),e.types=i.getTypes(),e.statuses=i.getStatus(),e.gotoList=function(){a.path("caches")},e.remove=function(t){if(confirm("Do you want to remove?")){o.get({cacheId:t}).$remove({cacheId:t});for(var a in e.caches)e.caches[a]._id===t&&e.caches.splice(a,1);s.setNotice("Delete cache success!","SUCCESS"),n.cacheId?e.gotoList():s.requireChange()}},e.findOne=function(){e.cache=o.get({cacheId:n.cacheId},function(t){t.image&&(e.review_file_name=e.webUrl+"/files/cache/"+t.image)})},e.currentPage=1,e.search={},e.setPage=function(t){e.currentPage=t},e.pageChanged=function(t){e.currentPage=t,l()},e.find=function(){if($.isEmptyObject(a.search())){var t=u.get("cache.filterData");t&&(e.currentPage=t.currentPage,e.search=t.search)}else{var t=a.search();e.currentPage=Number(t.currentPage)||1,e.search.keyword=t.keyword}l()},e.filter=function(){e.currentPage=1,l()},e.reset=function(){e.search.keyword="",e.currentPage=1,l()},e.removeAll=function(){confirm("Do you want to remove all?")&&o.removeAll(function(t){t.status?(e.caches=[],s.setNotice("Delete all cache success!","SUCCESS",!0)):s.setNotice("Delete all cache error!","ERROR",!0)})}}]),angular.module("caches").factory("Caches",["$resource",function(e){return e("admin/cache/:cacheId",{cacheId:"@_id"},{update:{method:"PUT"},query:{isArray:!1},removeAll:{url:"/admin/cache/removeAll",method:"PUT"}})}]),ApplicationConfiguration.registerModule("auth"),angular.module("auth").config(["$stateProvider",function(e){}]),angular.module("auth").controller("AuthenticationController",["$scope","$http","$location","$window","Authentication","$cookies",function(e,t,n,a,i,r){e.authentication=i,e.signin=function(){var n=e.credentials;n.scope="admin",t.post(a.settings.services.apiUrl+"/api/user/login",n).then(function(t){t.data.token&&(r.put("token",t.data.token,{path:"/"}),a.location.href="/admin"),e.error=t.message}).catch(function(t){e.error=t.message,console.log(e.error)})},e.signout=function(){t.get(a.settings.services.apiUrl+"/api/user/logout").then(function(t){e.authentication.user="",r.remove("token"),a.location.href="/admin"}).catch(function(t){e.error=t.message})}}]),angular.module("auth").factory("Authentication",["$window",function(e){return{user:e.user}}]),angular.module("core").directive("ckEditor",[function(){return{require:"?ngModel",restrict:"AEC",link:function(e,t,n,a){function i(){if(o.length){var e=o.splice(0,1);s.setData(e[0]||"<span></span>",function(){i(),r=!0})}}var r=!1,o=[],s=CKEDITOR.replace(t[0]);s.on("instanceReady",function(e){a&&i()}),t.bind("$destroy",function(){s.destroy(!1)}),a&&(s.on("change",function(){e.$apply(function(){var e=s.getData();"<span></span>"==e&&(e=null),a.$setViewValue(e)})}),a.$render=function(e){void 0===a.$viewValue&&(a.$setViewValue(""),a.$viewValue=""),o.push(a.$viewValue),r&&(r=!1,i())})}}}]),angular.module("core").directive("noticeDir",["Notice","$rootScope",function(e,t){var n=function(t,n){return n==e.ERROR?'<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h4><i class="icon fa fa-exclamation-triangle"></i> Error!</h4><div>'+t+"</div></div>":n==e.INFO?'<div class="alert alert-info alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h4><i class="icon fa fa-info"></i> Infomation!</h4><div>'+t+"</div></div>":'<div class="alert alert-success alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button><h4><i class="icon fa fa-check"></i> Success!</h4><div>'+t+"</div></div>"};return{restrict:"E",template:function(a,i){var r=e.getNotice();if(t.$on("CLEAR_NOTICE",function(){a.empty()}),t.$on("requireChange",function(){r=e.getNotice(),r.type==e.ERROR?a.html(n(r.message,e.ERROR)):r.type==e.INFO?a.html(n(r.message,e.INFO)):a.html(n(r.message,e.SUCCESS))}),""!=r)return r.type==e.ERROR?n(r.message,e.ERROR):r.type==e.INFO?n(r.message,e.INFO):n(r.message,e.SUCCESS)}}}]),angular.module("core").directive("errorMessage",function(){return{restrict:"E",template:function(e,t){return'<div ng-message="required">'+(t.requireMsg||"You did not enter a field")+'</div><div ng-message="email">You did not enter a email format</div><div ng-message="pattern">You did not enter a right pattern</div><div ng-message="number">You did not enter a number</div><div ng-message="min">You should enter bigger value</div><div ng-message="max">You should enter smaller value</div><div ng-message="minlength">'+(t.minlength?"You should enter longer than "+(t.minlength-1)+" characters":"You should enter longer in this field")+'</div><div ng-message="maxlength">'+(t.maxlength?"You should enter shorter than "+(t.maxlength+1)+" characters":"You should enter shorter in this field")+"</div>"}}}),angular.module("core").directive("ngLoading",function(){return{restrict:"AE",link:function(e,t,n){e.$watch(n.loadingDone,function(e){e?t.html('<div id="preview-area"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div><div class="mfp-bg bzFromTop mfp-ready"></div>'):t.html("")})}}}),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function(e,t,n){e.authentication=t,e.isCollapsed=!1,e.menu=n.getMenu("topbar")}]),angular.module("core").controller("HomeController",["$scope","$location","Authentication",function(e,t,n){e.authentication=n,e.checkAuth=function(){n.user.name||t.path("signin")}}]),angular.module("core").factory("Option",["$rootScope",function(e){var t=[{name:"Publish",value:1},{name:"Unpublish",value:0}],n=[{name:"Yes",value:1},{name:"No",value:0}],a=[{name:"Yes",value:1},{name:"No",value:0}],i=[{name:"Admin",value:"admin"},{name:"User",value:"user"}],r=[{name:"male",value:"male"},{name:"female",value:"female"}],o=[{name:"Product",value:"product"},{name:"Post",value:"post"},{name:"Banner",value:"banner"}],s=[{name:"home",value:"home"},{name:"right",value:"right"}],u=[{name:"top",value:"top"},{name:"right",value:"right"},{name:"home",value:"home"}];return{getStatus:function(){return t},getRoles:function(){return i},getGenders:function(){return r},getFeatures:function(){return n},getTypes:function(){return o},getYesNo:function(){return a},getPositions:function(){return s},getAdsPositions:function(){return u}}}]),angular.module("core").directive("status",function(){return{restrict:"EA",link:function(e,t,n){var a='<span class="label label-warning">unpublish</span>';1==n.status&&(a='<span class="label label-success">publish</span>'),t.append(a)}}}),ApplicationConfiguration.registerModule("pages"),angular.module("pages").run(["Menus",function(e){e.addMenuItem("topbar","Trang","pages","dropdown","/pages(/create)?"),e.addSubMenuItem("topbar","pages","Danh sách","pages"),e.addSubMenuItem("topbar","pages","Tạo mới","pages/create")}]).config(["$stateProvider",function(e){e.state("listPages",{url:"/pages",templateUrl:"/modules/admin-page/views/list-pages.client.view.html"}).state("createPage",{url:"/pages/create",templateUrl:"/modules/admin-page/views/create-page.client.view.html"}).state("viewPage",{url:"/pages/:pageId",templateUrl:"/modules/admin-page/views/view-page.client.view.html"}).state("editPage",{url:"/pages/:pageId/edit",templateUrl:"/modules/admin-page/views/edit-page.client.view.html"})}]),angular.module("pages").controller("PagesController",["$scope","$rootScope","$stateParams","$location","Authentication","Pages","Notice","localStorageService",function(e,t,n,a,i,r,o,s){function u(){var t={target_id:e.currentPage,keyword:e.search.keyword};s.set("page.filterData",{currenttarget_id:e.currentPage,search:e.search}),r.query(t,function(t){e.pages=t.items,e.totalItems=t.totalItems,e.itemsPerPage=t.itemsPerPage,e.numberVisiblePages=t.numberVisiblePages,e.totalPage=t.totalPage||1})}e.authentication=i,i.user.name||a.path("signin"),e.gotoList=function(){a.path("pages")},e.create=function(t,n){var n=void 0!==n?n:null;if(e.submitted=!0,!t)return void o.setNotice("Please check your fields and try again!","ERROR",!0);new r({title:this.title,intro:this.intro,content:this.content,identity:this.identity}).$save(function(t){t.error?o.setNotice(t.message,"ERROR",!0):(o.setNotice("Save page success!","SUCCESS"),n?e.gotoList():(a.path("pages/"+t._id+"/edit"),e.submitted=!1,e.title=""))},function(e){o.setNotice(e.data.message,"ERROR",!0)})},e.remove=function(t){if(confirm("Do you want to remove?")){r.get({pageId:t}).$remove({pageId:t},function(){});for(var a in e.pages)e.pages[a]._id===t&&e.pages.splice(a,1);o.setNotice("Delete page success!","SUCCESS"),n.pageId?e.gotoList():o.requireChange()}},e.update=function(t,n){if(e.submitted=!0,!t)return void o.setNotice("Please check your fields and try again!","ERROR",!0);var a=e.page;delete a.__v,delete a.created,a.$update(function(t){t.error?o.setNotice(t.message,"ERROR",!0):(o.setNotice("Update page success!","SUCCESS"),n?e.gotoList():(e.submitted=!1,o.requireChange()))},function(e){o.setNotice(e.data.message,"ERROR",!0)})},e.findOne=function(){e.page=r.get({pageId:n.pageId},function(){})},e.currentPage=1,e.search={},e.setPage=function(t){e.currentPage=t},e.pageChanged=function(t){e.currentPage=t,u()},e.find=function(){if($.isEmptyObject(a.search())){var t=s.get("page.filterData");t&&(e.currentPage=t.currentPage,e.search=t.search)}else{var t=a.search();e.currentPage=Number(t.currentPage)||1,e.search.keyword=t.keyword}u()},e.filter=function(){e.currentPage=1,u()},e.reset=function(){e.search.keyword="",e.currentPage=1,u()}}]),angular.module("pages").factory("Pages",["$resource",function(e){return e("admin/page/:pageId",{pageId:"@_id"},{update:{method:"PUT"},query:{isArray:!1}})}]);